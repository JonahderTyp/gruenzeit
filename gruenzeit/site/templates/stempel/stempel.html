{% extends "base.html" %}
{% block title %}Stempeln{% endblock %}
{% block content %}
<!-- <h1>Stempeln</h1>
<h1>Hallo {{current_user.name}}</h1>
<h1>Aktuell bist du {{ userstatus }}</h1>
<h1>Du kannst folgendes Stempeln:
    {% for timetype in useravailable %}
    {{timetype.name}}
    {%endfor%}</h1> -->


<div class="container mt-5">
    <h2 class="text-center mb-4">Deine Zeitleiste</h2>
    {% if not userTimesToday %}
    <div class="alert alert-warning" role="alert">
        Du hast heute noch keine Zeiten gestempelt.
    </div>
    {%else%}
    {% for userTime in userTimesToday %}

    <!-- FOR DEBUGGING: -->
    <!-- {{userTime}} -->

    <div class=" card shadow-sm">
        <div class="card-body">
            <h5 class="card-title">
                {{userTime.start_time}} -
                {% if userTime.end_time %}
                {{userTime.end_time}}
                {%else%}
                jetzt
                {%endif%}
                {%if userTime.duration %}
                ({{userTime.duration}})
                {%endif%}
            </h5>
            <small class="text-muted">
                {{userTime.timetype.name}}
            </small>
            <p class="card-text">
                {% if userTime.job %}
                {{userTime.job.name}}
                {%else%}
                Keine Baustelle ausgew√§hlt
                {%endif%}
            </p>
            <a class="btn btn-primary" href="#" role="button">Bearbeiten</a>
        </div>
    </div>
    {%endfor%}
    {%endif%}
</div>


<div class="container py-5">
    <div class="row">
        <div class="col-auto">
            <form action="{{ url_for('site.stempel.start')}}" id="timeForm" method="post">
                <div class="table-responsive">
                    <table>
                        <tbody>
                            <tr>
                                <td scope="row">
                                    <button type="button" class="btn btn-outline-secondary w-100"
                                        onclick="changeTime('hours', 1)"><i class="bi bi-arrow-up"></i></button>
                                </td>
                                <td>
                                    <button type="button" class="btn btn-outline-secondary w-100"
                                        onclick="changeTime('minutes', 15)"><i class="bi bi-arrow-up"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td scope="row">
                                    <input type="text" class="form-control" id="hours" name="hours"
                                        value="{% if currHour %} {{currHour}} {%else%} 12 {%endif%}" readonly>
                                </td>
                                <td>
                                    <input type="text" class="form-control" id="minutes" name="minutes"
                                        value="{% if currMin %} {{currMin}} {%else%} 0 {%endif%}" readonly>
                                </td>
                            </tr>
                            <tr>
                                <td scope="row">
                                    <button type="button" class="btn btn-outline-secondary w-100"
                                        onclick="changeTime('hours', -1)"><i class="bi bi-arrow-down"></i></button>
                                </td>
                                <td>
                                    <button type="button" class="btn btn-outline-secondary w-100"
                                        onclick="changeTime('minutes', -15)"><i class="bi bi-arrow-down"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="mb-3">
                    <label for="timetype">Select an option:</label>
                    <select class="form-control" id="timetype" name="timetype">
                        {% for timetype in timetypes %}
                        <option value="{{timetype.id}}">{{timetype.name}}</option>
                        {%endfor%}
                    </select>
                </div>

                <div class="mb-3">

                    <label for="baustelle">Select an option:</label>
                    <select class="form-select" name="baustelle" id="baustelle" aria-label="Default select example"
                        aria-describedby="baustelle">

                        <option selected value="">Keine</option>
                        {% for baustelle in baustellen %}
                        <option value="{{baustelle.id}}">{{baustelle.name}}</option>
                        {%endfor%}
                    </select>

                    <small id="baustelle" class="text-muted">Optional</small>
                </div>

                <div class="d-grid gap-2 mt-3">
                    <button type="submit" class="btn btn-primary">Submit Time</button>
                </div>
            </form>
        </div>
    </div>
</div>



<script>
    function changeTime(type, change) {
        const hoursInput = document.getElementById('hours');
        const minutesInput = document.getElementById('minutes');
        let hoursValue = parseInt(hoursInput.value);
        let minutesValue = parseInt(minutesInput.value);

        if (type === 'hours') {
            hoursValue += change;
            if (hoursValue > 23) hoursValue = 0;
            if (hoursValue < 0) hoursValue = 23;
            hoursInput.value = hoursValue.toString().padStart(2, '0');
        } else if (type === 'minutes') {
            minutesValue += change;
            if (minutesValue > 59) {
                minutesValue -= 60;
                changeTime('hours', 1); // Automatically adjust hour when minutes exceed 59
            }
            if (minutesValue < 0) {
                minutesValue += 60;
                changeTime('hours', -1); // Automatically adjust hour when minutes go below 0
            }
            minutesInput.value = minutesValue.toString().padStart(2, '0');
        }
    }
</script>
{% endblock %}